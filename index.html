<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>75 GIFTED</title>

  <!-- app meta -->
  <meta name="theme-color" content="#476313" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- optional share preview -->
  <meta property="og:title" content="75 GIFTED" />
  <meta property="og:description" content="a 75 day spiritual discipline challenge. track your ascension." />
  <meta property="og:image" content="social.png" />
  <meta property="og:type" content="website" />

  <!-- font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;600;900&display=swap" rel="stylesheet">

  <link rel="manifest" id="manifest-link" href="#" />
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <link rel="icon" type="image/png" href="icon-192.png" />

  <style>
    :root{
      --bg:#476313;
      --accent:#e2f2aa;
      --ink:#0c1203;
      --card:#3a5310;         /* dark green card */
      --card2:#2f430c;        /* deeper */
      --line:rgba(255,255,255,0.10);
      --muted:rgba(255,255,255,0.70);
      --muted2:rgba(255,255,255,0.55);
    }

    *{ margin:0; padding:0; box-sizing:border-box; }
    html, body{ height:100%; width:100%; }
    body{
      font-family:'Montserrat', -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #5b7c1a 0%, var(--bg) 70%);
      color:#fff;
    }

    /* splash */
    .splash-screen{
      position:fixed; inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding:24px;
      z-index:2000;
      background: linear-gradient(135deg, #5b7c1a 0%, var(--bg) 70%);
      overflow:hidden;
    }
    .splash-screen.active{ display:flex; }

    .splash-orb{
      position:absolute;
      width:380px; height:380px;
      border-radius:999px;
      filter: blur(40px);
      opacity:0.55;
      animation: floaty 6.5s ease-in-out infinite;
      background:
        radial-gradient(circle at 30% 30%, var(--accent), transparent 60%),
        radial-gradient(circle at 70% 70%, rgba(255,255,255,0.25), transparent 60%);
      z-index:1;
    }
    @keyframes floaty{
      0% { transform: translate(-30px, 10px) scale(1); }
      50% { transform: translate(40px, -30px) scale(1.06); }
      100% { transform: translate(-30px, 10px) scale(1); }
    }

    .splash-video{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      opacity:0.25;
      z-index:0;
      display:none;
    }

    .splash-card{
      width:100%;
      max-width:420px;
      background: rgba(18,25,6,0.55);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius:20px;
      padding:28px;
      text-align:center;
      box-shadow:0 12px 40px rgba(0,0,0,0.25);
      backdrop-filter: blur(12px);
      position:relative;
      z-index:2;
    }
    .splash-title{
      font-size:34px;
      font-weight:900;
      letter-spacing:-1px;
      text-transform:uppercase;
      color:#eda8ee(--accent);
    }
    .splash-sub{
      margin-top:10px;
      font-size:14px;
      color:var(--muted);
      text-transform:lowercase;
      line-height:1.5;
      font-weight:600;
    }
    .splash-actions{
      display:flex;
      gap:10px;
      margin-top:18px;
    }
    .splash-btn{
      flex:1;
      padding:16px;
      border:none;
      border-radius:14px;
      font-size:15px;
      font-weight:900;
      text-transform:lowercase;
      cursor:pointer;
      transition:transform .15s, opacity .15s;
      letter-spacing:-0.2px;
    }
    .splash-btn.primary{
      background:var(--accent);
      color:var(--ink);
      box-shadow:0 8px 18px rgba(226,242,170,0.22);
    }
    .splash-btn.primary:hover{ transform: translateY(-1px); opacity:0.95; }
    .splash-btn.secondary{
      background:rgba(255,255,255,0.10);
      color:#fff;
      border:1px solid rgba(255,255,255,0.16);
    }
    .splash-btn.secondary:hover{ transform: translateY(-1px); opacity:0.95; }

    /* app shell */
    .app-container{
      height:100%;
      width:100%;
      display:flex;
      flex-direction:column;
      background: transparent;
    }

    .header{
      background: rgba(18,25,6,0.45);
      border-bottom:1px solid rgba(255,255,255,0.10);
      padding:16px 20px 12px;
      text-align:center;
      backdrop-filter: blur(10px);
    }
    .header h1{
      font-size:20px;
      font-weight:900;
      letter-spacing:-1px;
      text-transform:uppercase;
      color:var(--accent);
    }
    .header .sub{
      margin-top:6px;
      font-size:12px;
      color:var(--muted);
      text-transform:lowercase;
      font-weight:600;
    }

    .tab-nav{
      display:flex;
      background: rgba(18,25,6,0.35);
      border-bottom:1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(10px);
    }
    .tab-button{
      flex:1;
      padding:14px 8px;
      background:none;
      border:none;
      font-size:13px;
      font-weight:900;
      text-transform:lowercase;
      color:var(--muted2);
      cursor:pointer;
      transition:all .2s;
      border-bottom:2px solid transparent;
      letter-spacing:-0.2px;
    }
    .tab-button.active{
      color:var(--accent);
      border-bottom-color:var(--accent);
    }

    .content{
      flex:1;
      overflow-y:auto;
      padding:20px;
    }

    .tab-content{ display:none; animation:fadeIn .25s; }
    .tab-content.active{ display:block; }
    @keyframes fadeIn{
      from{ opacity:0; transform:translateY(8px); }
      to{ opacity:1; transform:translateY(0); }
    }

    .card{
      background: linear-gradient(180deg, rgba(58,83,16,0.75), rgba(47,67,12,0.75));
      border: 1px solid rgba(255,255,255,0.12);
      border-radius:16px;
      padding:20px;
      margin-bottom:16px;
      box-shadow:0 10px 24px rgba(0,0,0,0.18);
      backdrop-filter: blur(10px);
    }

    /* today */
    .streak-display{ position:relative; text-align:center; padding:22px; }
    .countdown-timer{
      position:absolute; top:14px; right:14px;
      font-size:11px;
      color:var(--muted);
      text-transform:lowercase;
      background: rgba(255,255,255,0.10);
      padding:6px 10px;
      border-radius:8px;
      font-weight:900;
      letter-spacing:-0.2px;
    }
    .countdown-timer.urgent{
      background: rgba(255,80,80,0.18);
      color:#ffd7d7;
      border:1px solid rgba(255,120,120,0.25);
    }

    .streak-number{
      font-size:56px;
      font-weight:900;
      color:var(--accent);
      line-height:1;
      letter-spacing:-1px;
    }
    .streak-label{
      font-size:12px;
      text-transform:lowercase;
      color:var(--muted);
      margin-top:6px;
      letter-spacing:1px;
      font-weight:600;
    }
    .tasks-left{
      margin-top:10px;
      font-size:13px;
      color:#fff;
      text-transform:lowercase;
      font-weight:900;
    }
    .date-display{
      text-align:center;
      font-size:14px;
      color:var(--muted);
      text-transform:lowercase;
      margin:10px 0 16px;
      font-weight:600;
    }

    canvas{ width:100%; height:190px; display:block; }

    .stats-grid{
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:12px;
    }
    .stat-card{
      background: rgba(255,255,255,0.07);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:12px;
      padding:14px;
      text-align:center;
    }
    .stat-value{
      font-size:26px;
      font-weight:900;
      color:var(--accent);
      line-height:1.1;
      letter-spacing:-1px;
    }
    .stat-label{
      font-size:11px;
      text-transform:lowercase;
      color:var(--muted);
      margin-top:4px;
      font-weight:900;
      letter-spacing:0.4px;
    }

    /* checklist */
    .checklist-item{
      display:flex;
      align-items:center;
      padding:14px 0;
      border-bottom:1px solid rgba(255,255,255,0.08);
    }
    .checklist-item:last-child{ border-bottom:none; }

    .checkbox{
      appearance:none;
      width:24px; height:24px;
      border:2px solid rgba(255,255,255,0.25);
      border-radius:7px;
      cursor:pointer;
      transition:all .15s;
      position:relative;
      margin-right:14px;
      flex:0 0 auto;
      background: rgba(0,0,0,0.12);
    }
    .checkbox:checked{
      background:var(--accent);
      border-color:var(--accent);
    }
    .checkbox:checked::after{
      content:'‚úì';
      position:absolute;
      top:50%; left:50%;
      transform:translate(-50%,-50%);
      color:var(--ink);
      font-size:14px;
      font-weight:900;
    }
    .checklist-label{
      flex:1;
      font-size:15px;
      color:#fff;
      text-transform:lowercase;
      font-weight:600;
      line-height:1.25;
      letter-spacing:-0.2px;
    }
    .meta{
      font-size:12px;
      color:var(--accent);
      font-weight:900;
      margin-left:8px;
      text-transform:lowercase;
    }

    textarea{
      width:100%;
      min-height:110px;
      padding:12px;
      border:1px solid rgba(255,255,255,0.18);
      border-radius:12px;
      font-family:inherit;
      font-size:14px;
      resize:vertical;
      outline:none;
      background: rgba(0,0,0,0.14);
      color:#fff;
    }
    textarea::placeholder{ color: rgba(255,255,255,0.55); }
    textarea:focus{ border-color: rgba(226,242,170,0.55); }

    .bedtime-reminder{
      text-align:center;
      font-size:12px;
      color:var(--muted);
      margin:10px 0 12px;
      text-transform:lowercase;
      font-weight:600;
    }

    .btn{
      width:100%;
      padding:16px;
      border:none;
      border-radius:14px;
      font-size:15px;
      font-weight:900;
      text-transform:lowercase;
      cursor:pointer;
      transition:all .15s;
      letter-spacing:-0.2px;
    }
    .btn.primary{
      background:var(--accent);
      color:var(--ink);
      box-shadow:0 10px 22px rgba(226,242,170,0.18);
    }
    .btn.primary:hover{ transform:translateY(-1px); opacity:0.96; }

    .btn.secondary{
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.16);
      color:#fff;
    }
    .btn.secondary:hover{ transform:translateY(-1px); opacity:0.96; }

    .btn-row{
      display:flex;
      gap:10px;
    }
    .btn-row .btn{ width:auto; flex:1; }

    /* settings */
    .form-group{ margin-bottom:18px; }
    .form-label{
      display:block;
      font-size:13px;
      text-transform:lowercase;
      color:var(--muted);
      margin-bottom:8px;
      font-weight:900;
      letter-spacing:-0.2px;
    }
    input[type="text"], input[type="number"], input[type="time"], input[type="date"]{
      width:100%;
      padding:12px;
      border:1px solid rgba(255,255,255,0.18);
      border-radius:12px;
      font-family:inherit;
      font-size:14px;
      outline:none;
      background: rgba(0,0,0,0.14);
      color:#fff;
    }
    input:focus{ border-color: rgba(226,242,170,0.55); }

    .computed-value{
      font-size:18px;
      font-weight:900;
      color:var(--accent);
      padding:12px;
      background: rgba(0,0,0,0.14);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:12px;
      text-align:center;
      text-transform:lowercase;
      letter-spacing:-0.2px;
    }

    .toggle-wrapper{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .toggle{
      position:relative;
      width:48px; height:28px;
      background: rgba(255,255,255,0.18);
      border-radius:14px;
      cursor:pointer;
      transition:background .15s;
      flex:0 0 auto;
      border:1px solid rgba(255,255,255,0.12);
    }
    .toggle.active{ background: rgba(226,242,170,0.55); border-color: rgba(226,242,170,0.55); }
    .toggle-slider{
      position:absolute;
      top:3px; left:3px;
      width:22px; height:22px;
      background:#fff;
      border-radius:50%;
      transition:transform .15s;
    }
    .toggle.active .toggle-slider{ transform:translateX(20px); background: var(--accent); }

    .calendar-link{
      display:block;
      padding:14px;
      margin-top:10px;
      background: rgba(0,0,0,0.14);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:12px;
      text-decoration:none;
      color:var(--accent);
      font-size:14px;
      text-align:center;
      font-weight:900;
      text-transform:lowercase;
      transition:all .15s;
      letter-spacing:-0.2px;
    }
    .calendar-link:hover{
      background: rgba(226,242,170,0.18);
      transform:translateY(-1px);
    }

    /* rules */
    .rules-card{ line-height:1.7; }
    .rules-card h2{
      font-size:20px;
      font-weight:900;
      text-transform:uppercase;
      color:var(--accent);
      margin-bottom:14px;
      text-align:center;
      letter-spacing:-1px;
    }
    .rules-card h3{
      font-size:14px;
      font-weight:900;
      text-transform:lowercase;
      color:#fff;
      margin-top:14px;
      margin-bottom:8px;
      letter-spacing:-0.2px;
    }
    .rules-card p, .rules-card li{
      font-size:14px;
      color:var(--muted);
      text-transform:lowercase;
      font-weight:700;
      letter-spacing:-0.1px;
    }
    .rules-card ol{ margin-left:18px; }

    /* modal */
    .overlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:3000;
      padding:20px;
    }
    .overlay.active{ display:flex; }

    .modal{
      width:100%;
      max-width:380px;
      background: rgba(18,25,6,0.75);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius:18px;
      padding:22px;
      text-align:center;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      backdrop-filter: blur(12px);
    }
    .modal .icon{ font-size:44px; margin-bottom:10px; }
    .modal .title{
      font-size:16px;
      font-weight:900;
      color:#fff;
      text-transform:lowercase;
      letter-spacing:-0.6px;
    }
    .modal .text{
      margin-top:8px;
      font-size:14px;
      color:var(--muted);
      line-height:1.45;
      text-transform:lowercase;
      font-weight:700;
    }

    /* share overlay + share card */
    .share-card{
      width:100%;
      max-width:420px;
      background: linear-gradient(135deg, #5b7c1a 0%, var(--bg) 70%);
      border-radius:20px;
      border: 1px solid rgba(255,255,255,0.14);
      padding:18px;
      text-align:left;
    }
    .share-header{
      text-transform:uppercase;
      color:var(--accent);
      font-weight:900;
      letter-spacing:-0.6px;
      font-size:14px;
      margin-bottom:10px;
    }
    .share-sub{
      color:rgba(255,255,255,0.85);
      font-weight:600;
      font-size:12px;
      margin-top:2px;
      text-transform:lowercase;
    }
    .share-kpis{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:10px;
      margin:10px 0 12px;
    }
    .share-kpi{
      background: rgba(0,0,0,0.18);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:14px;
      padding:10px;
      text-align:center;
    }
    .share-kpi .v{
      color:var(--accent);
      font-weight:900;
      font-size:18px;
      letter-spacing:-0.8px;
    }
    .share-kpi .l{
      color:rgba(255,255,255,0.75);
      font-weight:900;
      font-size:10px;
      text-transform:lowercase;
      margin-top:2px;
    }
    .share-rules{
      margin-top:12px;
      font-size:10px;
      line-height:1.4;
      color:rgba(255,255,255,0.75);
      text-transform:lowercase;
      font-weight:600;
      border-top:1px solid rgba(255,255,255,0.14);
      padding-top:10px;
    }
    .share-canvas{
      width:100%;
      height:220px;
      display:block;
      border-radius:14px;
      background: rgba(0,0,0,0.18);
      border:1px solid rgba(255,255,255,0.10);
    }
  </style>
</head>

<body>
  <!-- splash -->
  <div class="splash-screen" id="splash-screen">
    <video class="splash-video" id="splash-video" autoplay muted loop playsinline>
      <source src="splash.mp4" type="video/mp4">
    </video>
    <div class="splash-orb" aria-hidden="true"></div>

    <div class="splash-card">
      <div class="splash-title">75 GIFTED</div>
      <div class="splash-sub">a 75-day spiritual discipline challenge.</div>
      <div class="splash-actions">
        <button class="splash-btn secondary" id="open-settings-btn">day 1 setup</button>
        <button class="splash-btn primary" id="open-main-btn">log day</button>
      </div>
    </div>
  </div>

  <!-- app -->
  <div class="app-container" id="app-container">
    <div class="header">
      <h1>75 GIFTED</h1>
      <div class="sub" id="header-sub">stay gifted.</div>
    </div>

    <nav class="tab-nav">
      <button class="tab-button active" data-tab="today">today</button>
      <button class="tab-button" data-tab="settings">settings</button>
      <button class="tab-button" data-tab="rules">rules</button>
    </nav>

    <div class="content">
      <!-- today -->
      <div id="today-tab" class="tab-content active">
        <div class="card">
          <canvas id="streak-chart"></canvas>
        </div>

        <div class="stats-grid" style="margin-bottom:16px;">
          <div class="stat-card">
            <div class="stat-value" id="stat-current">0</div>
            <div class="stat-label">current</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-longest">0</div>
            <div class="stat-label">longest</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-wins">0</div>
            <div class="stat-label">days elapsed</div>
          </div> function getDaysElapsed() {
  if (!appState.settings.startDate) return 0;

  const start = new Date(appState.settings.startDate + 'T00:00:00');
  const today = new Date();
  today.setHours(0,0,0,0);

  const diffMs = today - start;
  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24)) + 1;

  return diffDays > 0 ? diffDays : 0;
}

        </div>

        <div class="card streak-display">
          <div class="countdown-timer" id="countdown-timer">--:--:--</div>
          <div class="streak-number" id="current-streak">0</div>
          <div class="streak-label">day streak</div>
          <div class="tasks-left" id="tasks-left">7 tasks left</div>
        </div>

        <div class="date-display" id="today-date"></div>

        <div class="card">
          <div class="checklist-item">
            <input type="checkbox" class="checkbox" id="check-0">
            <label for="check-0" class="checklist-label">pray fervently</label>
          </div>

          <div class="checklist-item">
            <input type="checkbox" class="checkbox" id="check-1">
            <label for="check-1" class="checklist-label">
              drink enough water <span class="meta" id="water-target"></span>
            </label>
          </div>

          <div class="checklist-item">
            <input type="checkbox" class="checkbox" id="check-2">
            <label for="check-2" class="checklist-label">read bible for 10 mins</label>
          </div>

          <div class="checklist-item">
            <input type="checkbox" class="checkbox" id="check-3">
            <label for="check-3" class="checklist-label">weekly generosity (where God calls)</label>
          </div>

          <div class="checklist-item">
            <input type="checkbox" class="checkbox" id="check-4">
            <label for="check-4" class="checklist-label" id="gift-label">share your gift publicly</label>
          </div>

          <div class="checklist-item">
            <input type="checkbox" class="checkbox" id="check-5">
            <label for="check-5" class="checklist-label">45 mins of movement</label>
          </div>

          <div class="checklist-item">
            <input type="checkbox" class="checkbox" id="check-6">
            <label for="check-6" class="checklist-label" id="vices-label">no vices or temptations</label>
          </div>
        </div>

        <div class="card">
          <div class="form-label" style="margin-bottom:10px;">reflection (optional but powerful)</div>
          <textarea id="today-notes" placeholder="quick reflection:
1) what did God highlight today?
2) where did i resist discipline?
3) what will i do differently tomorrow?
4) one thing i'm grateful for..."></textarea>
        </div>

        <div class="bedtime-reminder" id="bedtime-reminder"></div>

          <button class="btn primary" id="end-day-btn">end day</button>
        </div>
      </div>

      <!-- settings -->
      <div id="settings-tab" class="tab-content">
        <div class="card">
          <div class="form-group">
            <label class="form-label" for="start-date">start date (optional)</label>
            <input type="date" id="start-date">
          </div>

          <div class="form-group">
            <label class="form-label" for="wakeup-time">wakeup time</label>
            <input type="time" id="wakeup-time" value="06:00">
          </div>

          <div class="form-group">
            <label class="form-label" for="bedtime">bedtime</label>
            <input type="time" id="bedtime" value="22:00">
          </div>

          <div class="form-group">
            <label class="form-label" for="body-weight">body weight (lbs)</label>
            <input type="number" id="body-weight" value="150" min="50" max="500">
          </div>

          <div class="form-group">
            <label class="form-label" for="daily-gift">commit to one gift/talent you‚Äôll actively share daily</label>
            <input type="text" id="daily-gift" placeholder="ex: encouragement reel, applying a skill, public speaking...">
          </div>

          <div class="form-group">
            <label class="form-label" for="vices-text">name your specific vices/temptations to surrender</label>
            <input type="text" id="vices-text" placeholder="ex: alcohol, scrolling, porn, weed, gossip, sugar...">
          </div>

          <div class="form-group">
            <label class="form-label">water target</label>
            <div class="computed-value" id="computed-water">0 oz</div>
          </div>

          <div class="form-group">
            <div class="toggle-wrapper">
              <label class="form-label" style="margin-bottom:0;">reminders</label>
            </div>

            <div style="margin-top:10px; font-size:12px; color:rgba(255,255,255,0.70); text-transform:lowercase; font-weight:600;">
              add calendar reminders (brownie points if you set them for daily reminder)
            </div>

            <a class="calendar-link" id="wakeup-calendar" target="_blank" rel="noopener noreferrer" href="#">add wakeup reminder to calendar</a>
            <a class="calendar-link" id="midday-calendar" target="_blank" rel="noopener noreferrer" href="#">add midday check-in to calendar</a>
            <a class="calendar-link" id="bedtime-calendar" target="_blank" rel="noopener noreferrer" href="#">add final reminder to calendar</a>
          </div>
        </div>

        <button class="btn secondary" id="finish-setup-btn">finish setup</button>
      </div>

      <!-- rules -->
      <div id="rules-tab" class="tab-content">
        <div class="card rules-card">
          <h2>75 GIFTED</h2>

          <h3>daily mission</h3>
          <p>complete all 7 items before bedtime:</p>
          <ol>
            <li>P.R.A.Y. fervently (praise, repent, ask, YES!)</li>
            <li>drink your water goal</li>
            <li>read bible for 10 minutes</li>
            <li>serve weekly (where God is calling you to give most)</li>
            <li>share your gift publicly</li>
            <li>45 minutes of movement</li>
            <li>no vices / no compromises</li>
          </ol>

          <h3>the rules</h3>
          <p>within 2 hours of bedtime, press ‚Äúend day.‚Äù</p>
          <p>it's all or nothing. all items checked = win day + streak rises. one missing = loss + reset to 0.</p>
          <p>this is where we break the cycle of "not feeling like it" + adopting a steward's attitude to nurturing His gifts.</p>

          <h3>the goal</h3>
          <p>reach 75 consecutive days of victory. grow your gifts.</p>
          <p>you got this! love, ki</p>
        </div>
      </div>
    </div>
  </div>

  <!-- modal -->
  <div class="overlay" id="message-overlay">
    <div class="modal">
      <div class="icon" id="message-icon">‚úì</div>
      <div class="title" id="message-title">ok</div>
      <div class="text" id="message-text">message</div>
      <div style="margin-top:14px;">
        <button class="btn primary" id="message-ok">continue</button>
      </div>
    </div>
  </div>

  <!-- share overlay -->
  <div class="overlay" id="share-overlay">
    <div class="modal" style="max-width:460px; text-align:left;">
      <div class="share-card" id="share-card">
        <div class="share-header">75 GIFTED, a 75 day spiritual discipline challenge</div>
        <div class="share-sub" id="share-date"></div>

        <canvas class="share-canvas" id="share-canvas"></canvas>

        <div class="share-kpis">
          <div class="share-kpi">
            <div class="v" id="share-current">0</div>
            <div class="l">current</div>
          </div>
          <div class="share-kpi">
            <div class="v" id="share-longest">0</div>
            <div class="l">longest</div>
          </div>
          <div class="share-kpi">
            <div class="v" id="share-left">0</div>
            <div class="l">tasks left</div>
          </div>
        </div>

        <div class="share-rules">
          rules: complete all 7 items before bedtime. within 2 hours of bedtime press ‚Äúend day.‚Äù
          all checked = win + streak rises. missing any = loss + reset to 0. no pausing.
        </div>
      </div>

      <div class="btn-row" style="margin-top:12px;">
        <button class="btn secondary" id="download-share-btn">download png</button>
        <button class="btn primary" id="native-share-btn">share</button>
      </div>

      <div style="margin-top:10px;">
        <button class="btn secondary" id="close-share-btn">close</button>
      </div>
    </div>
  </div>

  <script>
    const APP_DATA_KEY = '75_gifted_data_v5';

    const defaultState = {
      currentStreak: 0,
      longestStreak: 0,
      history: [],
      settings: {
        onboarded: false,
        startDate: null,
        wakeupTime: '06:00',
        bedtime: '22:00',
        bodyWeight: 150,
        : false,
        dailyGift: '',
        vicesText: ''
      },
      today: {
        date: null,
        checks: [false,false,false,false,false,false,false],
        notes: '',
        ended: false
      }
    };

    let appState = structuredClone(defaultState);

    function saveData(){ localStorage.setItem(APP_DATA_KEY, JSON.stringify(appState)); }
    function loadData(){
      const saved = localStorage.getItem(APP_DATA_KEY);
      if (saved){
        try { appState = { ...appState, ...JSON.parse(saved) }; }
        catch { appState = structuredClone(defaultState); }
      }
    }

    function getTodayString(){
      const now = new Date();
      return `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;
    }
    function addDays(dateStr, days){
      const d = new Date(dateStr + 'T00:00:00');
      d.setDate(d.getDate() + days);
      return d.toISOString().slice(0,10);
    }
    function formatDate(dateStr){
      const d = new Date(dateStr + 'T00:00:00');
      return d.toLocaleDateString('en-US', { weekday:'long', month:'long', day:'numeric', year:'numeric' }).toLowerCase();
    }

    function waterTargetOz(){
      return Math.round((Number(appState.settings.bodyWeight || 0) / 2) + 8);
    }

    function showModal(icon, title, text){
      document.getElementById('message-icon').textContent = icon;
      document.getElementById('message-title').textContent = title;
      document.getElementById('message-text').textContent = text;
      document.getElementById('message-overlay').classList.add('active');
    }
    function hideModal(){ document.getElementById('message-overlay').classList.remove('active'); }

    function showSplash(){
      document.getElementById('splash-screen').classList.add('active');
      document.getElementById('app-container').style.display = 'none';
    }
    function hideSplash(){
      document.getElementById('splash-screen').classList.remove('active');
      document.getElementById('app-container').style.display = 'flex';
    }

    function initSplashVideo(){
      const vid = document.getElementById('splash-video');
      if (!vid) return;
      vid.addEventListener('canplay', () => { vid.style.display = 'block'; });
      vid.addEventListener('error', () => { vid.style.display = 'none'; });
      vid.play().catch(()=>{});
    }

    function openTab(name){
      document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      const btn = document.querySelector(`.tab-button[data-tab="${name}"]`);
      const tab = document.getElementById(`${name}-tab`);
      if (btn) btn.classList.add('active');
      if (tab) tab.classList.add('active');
      if (name === 'today') setTimeout(drawChart, 30);
    }

    function checkNewDayAndMisses(){
      const today = getTodayString();

      if (!appState.today.date){
        appState.today.date = today;
        saveData();
        return;
      }
      if (appState.today.date === today) return;

      if (!appState.today.ended){
        appState.history.push({ date: appState.today.date, completed:false, streakAfter:0, notes: appState.today.notes || '' });
        appState.currentStreak = 0;
      }

      let cursor = addDays(appState.today.date, 1);
      while (cursor !== today){
        appState.history.push({ date: cursor, completed:false, streakAfter:0, notes:'' });
        cursor = addDays(cursor, 1);
      }

      appState.today = { date: today, checks:[false,false,false,false,false,false,false], notes:'', ended:false };
      saveData();
    }

    function updateBedtimeCountdown(){
      const el = document.getElementById('countdown-timer');
      const [bh, bm] = appState.settings.bedtime.split(':').map(n => parseInt(n,10));
      const now = new Date();
      const bedtime = new Date(now);
      bedtime.setHours(bh, bm, 0, 0);

      const diffMs = bedtime - now;
      if (diffMs <= 0){
        el.textContent = '00:00:00';
        el.classList.add('urgent');
        return;
      }

      const totalSeconds = Math.floor(diffMs / 1000);
      const hrs = Math.floor(totalSeconds / 3600);
      const mins = Math.floor((totalSeconds % 3600) / 60);
      const secs = totalSeconds % 60;

      el.textContent = `${String(hrs).padStart(2,'0')}:${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}`;

      if (totalSeconds <= 3600) el.classList.add('urgent');
      else el.classList.remove('urgent');
    }

    function isWithinBedtimeWindow(){
      const now = new Date();
      const currentMins = now.getHours()*60 + now.getMinutes();
      const [bh, bm] = appState.settings.bedtime.split(':').map(n => parseInt(n,10));
      const bedtimeMins = bh*60 + bm;
      return currentMins >= (bedtimeMins - 120);
    }

    function updateTasksLeft(){
      const left = appState.today.checks.filter(v => !v).length;
      document.getElementById('tasks-left').textContent = `${left} task${left===1?'':'s'} left`;
      return left;
    }

    function updateCalendarLinks(){
      const today = new Date();
      const dateStr = today.toISOString().split('T')[0].replace(/-/g,'');

      const wake = appState.settings.wakeupTime.split(':').map(Number);
      const bed  = appState.settings.bedtime.split(':').map(Number);

      const wakeM = wake[0]*60 + wake[1];
      const bedM  = bed[0]*60 + bed[1];

      const middayM = Math.floor((wakeM + bedM)/2);
      const lastLapM = bedM - 60;

      function hhmm(mins){
        const h = String(Math.floor(mins/60)).padStart(2,'0');
        const m = String(mins%60).padStart(2,'0');
        return [h,m];
      }
      function endBlock(mins){
        const [eh, em] = hhmm(mins + 60);
        return `${eh}${em}00`;
      }

      const wakeStart = `${String(wake[0]).padStart(2,'0')}${String(wake[1]).padStart(2,'0')}00`;
      const wakeEnd   = endBlock(wakeM);

      const [midH, midMin] = hhmm(middayM);
      const midStart  = `${midH}${midMin}00`;
      const midEnd    = endBlock(middayM);

      const [lapH, lapMin] = hhmm(lastLapM);
      const lapStart  = `${lapH}${lapMin}00`;
      const lapEnd    = endBlock(lastLapM);

      document.getElementById('wakeup-calendar').href =
        `https://calendar.google.com/calendar/render?action=TEMPLATE&text=75+GIFTED:+Rise+%26+Seek&details=rise+%26+seek.+today+is+75+gifted.&dates=${dateStr}T${wakeStart}/${dateStr}T${wakeEnd}&recur=RRULE:FREQ=DAILY`;

      document.getElementById('midday-calendar').href =
        `https://calendar.google.com/calendar/render?action=TEMPLATE&text=75+GIFTED:+Midday+Check-In&details=midday+check-in.+finish+your+7.&dates=${dateStr}T${midStart}/${dateStr}T${midEnd}&recur=RRULE:FREQ=DAILY`;

      document.getElementById('bedtime-calendar').href =
        `https://calendar.google.com/calendar/render?action=TEMPLATE&text=75+GIFTED:+Last+Lap&details=last+lap.+finish+your+7.&dates=${dateStr}T${lapStart}/${dateStr}T${lapEnd}&recur=RRULE:FREQ=DAILY`;
    }

    function updateTodayUI(){
      document.getElementById('current-streak').textContent = appState.currentStreak;
      document.getElementById('today-date').textContent = formatDate(appState.today.date);

      document.getElementById('stat-current').textContent = appState.currentStreak;
      document.getElementById('stat-longest').textContent = appState.longestStreak;
      document.getElementById('stat-wins').textContent = appState.history.filter(h => h.completed).length;

      document.getElementById('water-target').textContent = `(${waterTargetOz()} oz)`;

      const gift = (appState.settings.dailyGift || '').trim();
      document.getElementById('gift-label').textContent = gift ? `share your gift: ${gift}` : 'share your gift publicly';

      const vices = (appState.settings.vicesText || '').trim();
      document.getElementById('vices-label').textContent = vices ? `no vices: ${vices}` : 'no vices or temptations';

      for (let i=0;i<7;i++){
        document.getElementById(`check-${i}`).checked = !!appState.today.checks[i];
      }

      document.getElementById('today-notes').value = appState.today.notes || '';
      document.getElementById('bedtime-reminder').textContent = `all seven before bedtime: ${appState.settings.bedtime}`;

      updateTasksLeft();
      updateBedtimeCountdown();
      drawChart();
    }

    function updateSettingsUI(){
      document.getElementById('start-date').value = appState.settings.startDate || '';
      document.getElementById('wakeup-time').value = appState.settings.wakeupTime;
      document.getElementById('bedtime').value = appState.settings.bedtime;
      document.getElementById('body-weight').value = appState.settings.bodyWeight;
      document.getElementById('daily-gift').value = appState.settings.dailyGift || '';
      document.getElementById('vices-text').value = appState.settings.vicesText || '';

      document.getElementById('computed-water').textContent = `${waterTargetOz()} oz (half bw + 8)`;

      updateCalendarLinks();
    }

    function markOnboardedIfReady(){
      const ready =
        appState.settings.wakeupTime &&
        appState.settings.bedtime &&
        Number(appState.settings.bodyWeight) > 0 &&
        (appState.settings.dailyGift || '').trim().length > 0 &&
        (appState.settings.vicesText || '').trim().length > 0;

      if (ready && !appState.settings.onboarded){
        appState.settings.onboarded = true;
        saveData();
      }
      return ready;
    }

    function drawChart(){
      const canvas = document.getElementById('streak-chart');
      const ctx = canvas.getContext('2d');
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();

      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      ctx.setTransform(dpr,0,0,dpr,0,0);

      const width = rect.width;
      const height = rect.height;

      ctx.clearRect(0,0,width,height);

      const data = appState.history.slice(-75);
      if (data.length === 0){
        ctx.fillStyle = 'rgba(255,255,255,0.75)';
        ctx.font = '14px Montserrat, sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('no ascension data yet', width/2, height/2);
        return;
      }

      const maxStreak = Math.max(10, ...data.map(d => d.streakAfter), appState.currentStreak);
      const padding = 34;
      const chartW = width - padding*2;
      const chartH = height - padding*2;

      const xStep = chartW / Math.max(data.length-1, 1);
      const yScale = chartH / maxStreak;

      // grid
      ctx.strokeStyle = 'rgba(255,255,255,0.10)';
      ctx.lineWidth = 1;
      for (let i=0;i<=4;i++){
        const y = padding + (chartH/4)*i;
        ctx.beginPath();
        ctx.moveTo(padding, y);
        ctx.lineTo(width-padding, y);
        ctx.stroke();

        const val = Math.round(maxStreak - (maxStreak/4)*i);
        ctx.fillStyle = 'rgba(255,255,255,0.60)';
        ctx.font = '11px Montserrat, sans-serif';
        ctx.textAlign = 'right';
        ctx.fillText(String(val), padding-8, y+4);
      }

      // line
      ctx.strokeStyle = '#e2f2aa';
      ctx.lineWidth = 2.8;
      ctx.lineJoin = 'round';
      ctx.lineCap = 'round';
      ctx.beginPath();
      data.forEach((p, idx) => {
        const x = padding + idx*xStep;
        const y = padding + chartH - (p.streakAfter*yScale);
        if (idx===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
      });
      ctx.stroke();

      // dots
      ctx.fillStyle = '#e2f2aa';
      data.forEach((p, idx) => {
        const x = padding + idx*xStep;
        const y = padding + chartH - (p.streakAfter*yScale);
        ctx.beginPath();
        ctx.arc(x,y,3.2,0,Math.PI*2);
        ctx.fill();
      });
    }

    // --- share card drawing (canvas-only, no external libs) ---
    function drawShareCanvas(){
      const c = document.getElementById('share-canvas');
      const ctx = c.getContext('2d');

      const dpr = window.devicePixelRatio || 1;
      const rect = c.getBoundingClientRect();
      c.width = rect.width * dpr;
      c.height = rect.height * dpr;
      ctx.setTransform(dpr,0,0,dpr,0,0);

      const w = rect.width;
      const h = rect.height;

      // background
      const grad = ctx.createLinearGradient(0,0,w,h);
      grad.addColorStop(0, '#5b7c1a');
      grad.addColorStop(1, '#476313');
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,w,h);

      // inner panel
      ctx.fillStyle = 'rgba(0,0,0,0.22)';
      roundRect(ctx, 12, 12, w-24, h-24, 14);
      ctx.fill();

      // mini chart area
      const data = appState.history.slice(-30);
      const maxStreak = Math.max(10, ...data.map(d => d.streakAfter), appState.currentStreak);

      const pad = 26;
      const cw = w - pad*2;
      const ch = h - pad*2;

      // grid
      ctx.strokeStyle = 'rgba(255,255,255,0.10)';
      ctx.lineWidth = 1;
      for (let i=0;i<=4;i++){
        const y = pad + (ch/4)*i;
        ctx.beginPath();
        ctx.moveTo(pad, y);
        ctx.lineTo(w-pad, y);
        ctx.stroke();
      }

      if (data.length === 0){
        ctx.fillStyle = 'rgba(255,255,255,0.75)';
        ctx.font = '14px Montserrat, sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('no data yet', w/2, h/2);
        return;
      }

      const xStep = cw / Math.max(data.length-1, 1);
      const yScale = ch / maxStreak;

      // line
      ctx.strokeStyle = '#e2f2aa';
      ctx.lineWidth = 3;
      ctx.lineJoin = 'round';
      ctx.lineCap = 'round';
      ctx.beginPath();
      data.forEach((p, idx) => {
        const x = pad + idx*xStep;
        const y = pad + ch - (p.streakAfter*yScale);
        if (idx===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
      });
      ctx.stroke();

      // dots
      ctx.fillStyle = '#e2f2aa';
      data.forEach((p, idx) => {
        const x = pad + idx*xStep;
        const y = pad + ch - (p.streakAfter*yScale);
        ctx.beginPath();
        ctx.arc(x,y,3.4,0,Math.PI*2);
        ctx.fill();
      });
    }

    function roundRect(ctx, x, y, w, h, r){
      const radius = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+radius, y);
      ctx.arcTo(x+w, y, x+w, y+h, radius);
      ctx.arcTo(x+w, y+h, x, y+h, radius);
      ctx.arcTo(x, y+h, x, y, radius);
      ctx.arcTo(x, y, x+w, y, radius);
      ctx.closePath();
    }

    function openShare(){
      // fill share ui
      document.getElementById('share-date').textContent = formatDate(appState.today.date);
      document.getElementById('share-current').textContent = appState.currentStreak;
      document.getElementById('share-longest').textContent = appState.longestStreak;
      const left = appState.today.checks.filter(v => !v).length;
      document.getElementById('share-left').textContent = left;

      // draw chart onto share canvas
      drawShareCanvas();

      document.getElementById('share-overlay').classList.add('active');
    }
    function closeShare(){ document.getElementById('share-overlay').classList.remove('active'); }

    function downloadSharePNG(){
      const c = document.getElementById('share-canvas');
      const url = c.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url;
      a.download = `75-gifted-${appState.today.date}.png`;
      document.body.appendChild(a);
      a.click();
      a.remove();
    }

    async function nativeShare(){
      const c = document.getElementById('share-canvas');
      if (!navigator.share){
        showModal('üìå', 'share', 'your browser doesn‚Äôt support native share. use download png instead.');
        return;
      }

      // convert canvas to blob -> file
      const blob = await new Promise(res => c.toBlob(res, 'image/png'));
      const file = new File([blob], `75-gifted-${appState.today.date}.png`, { type:'image/png' });

      try{
        await navigator.share({
          title: '75 GIFTED',
          text: '75 GIFTED, a 75 day spiritual discipline challenge',
          files: [file]
        });
      } catch(e){
        // user canceled or share failed
      }
    }

    function endDay(){
      const allChecked = appState.today.checks.every(Boolean);

      if (allChecked){
        appState.currentStreak++;
        appState.longestStreak = Math.max(appState.longestStreak, appState.currentStreak);

        appState.history.push({
          date: appState.today.date,
          completed: true,
          streakAfter: appState.currentStreak,
          notes: appState.today.notes || ''
        });

        appState.today.ended = true;
        saveData();
        showModal('üî•', 'day won', `all 7 complete. streak: ${appState.currentStreak}`);
      } else {
        appState.currentStreak = 0;

        appState.history.push({
          date: appState.today.date,
          completed: false,
          streakAfter: 0,
          notes: appState.today.notes || ''
        });

        appState.today.ended = true;
        saveData();
        showModal('üíî', 'day lost', 'not all items were completed. streak reset to 0.');
      }

      updateTodayUI();
      updateSettingsUI();
    }

    // events
    document.querySelectorAll('.tab-button').forEach(btn => {
      btn.addEventListener('click', () => openTab(btn.dataset.tab));
    });

    for (let i=0;i<7;i++){
      document.getElementById(`check-${i}`).addEventListener('change', (e) => {
        appState.today.checks[i] = e.target.checked;
        saveData();
        updateTasksLeft();
      });
    }

    document.getElementById('today-notes').addEventListener('input', (e) => {
      appState.today.notes = e.target.value;
      saveData();
    });

    document.getElementById('end-day-btn').addEventListener('click', () => {
      if (!isWithinBedtimeWindow()){
        showModal('‚è≥', 'too early', 'you can only end your day within 2 hours of bedtime. come back later.');
        return;
      }
      endDay();
    });

    document.getElementById('share-progress-btn').addEventListener('click', openShare);
    document.getElementById('close-share-btn').addEventListener('click', closeShare);
    document.getElementById('download-share-btn').addEventListener('click', downloadSharePNG);
    document.getElementById('native-share-btn').addEventListener('click', nativeShare);

    document.getElementById('message-ok').addEventListener('click', hideModal);

    document.getElementById('start-date').addEventListener('change', (e) => {
      appState.settings.startDate = e.target.value || null;
      saveData();
    });

    document.getElementById('wakeup-time').addEventListener('change', (e) => {
      appState.settings.wakeupTime = e.target.value;
      saveData();
      updateSettingsUI();
      markOnboardedIfReady();
    });

    document.getElementById('bedtime').addEventListener('change', (e) => {
      appState.settings.bedtime = e.target.value;
      saveData();
      updateSettingsUI();
      updateTodayUI();
      markOnboardedIfReady();
    });

    document.getElementById('body-weight').addEventListener('input', (e) => {
      appState.settings.bodyWeight = Number(e.target.value) || 150;
      saveData();
      updateSettingsUI();
      updateTodayUI();
      markOnboardedIfReady();
    });

    document.getElementById('daily-gift').addEventListener('input', (e) => {
      appState.settings.dailyGift = e.target.value;
      saveData();
      updateTodayUI();
      markOnboardedIfReady();
    });

    document.getElementById('vices-text').addEventListener('input', (e) => {
      appState.settings.vicesText = e.target.value;
      saveData();
      updateTodayUI();
      markOnboardedIfReady();
    });

    document.getElementById('reminders-toggle').addEventListener('click', () => {
      appState.settings.reminders = !appState.settings.reminders;
      saveData();
      updateSettingsUI();
    });

    document.getElementById('finish-setup-btn').addEventListener('click', () => {
      const ready = markOnboardedIfReady();
      if (!ready){
        showModal('üß©', 'finish setup', 'add your daily gift + your vices, plus bedtime + bodyweight.');
        openTab('settings');
        return;
      }
      showModal('‚úÖ', 'setup complete', 'all set! time to activate your God-given gifts!');
      saveData();
      showSplash();
    });

    // splash buttons
    document.getElementById('open-main-btn').addEventListener('click', () => {
      hideSplash();
      if (!appState.settings.onboarded){
        openTab('settings');
      } else {
        openTab('today');
        updateTodayUI();
      }
    });

    document.getElementById('open-settings-btn').addEventListener('click', () => {
      hideSplash();
      openTab('settings');
    });

    window.addEventListener('resize', () => {
      drawChart();
      if (document.getElementById('share-overlay').classList.contains('active')) drawShareCanvas();
    });

    // dynamic manifest so it installs nicer on android/chrome
    function setDynamicManifest(){
      const svg = encodeURIComponent(`
        <svg xmlns="http://www.w3.org/2000/svg" width="512" height="512">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#5b7c1a"/>
              <stop offset="1" stop-color="#476313"/>
            </linearGradient>
          </defs>
          <rect width="512" height="512" rx="96" fill="url(#g)"/>
          <circle cx="210" cy="210" r="140" fill="#e2f2aa" opacity="0.92"/>
          <text x="256" y="315" text-anchor="middle" font-family="Montserrat, Arial" font-size="88" font-weight="900" fill="#0c1203">75</text>
        </svg>
      `);
      const iconData = `data:image/svg+xml;charset=utf-8,${svg}`;

      const manifest = {
        name: "75 GIFTED",
        short_name: "75 GIFTED",
        start_url: ".",
        display: "standalone",
        background_color: "#476313",
        theme_color: "#476313",
        icons: [
          { src: iconData, sizes: "192x192", type: "image/svg+xml" },
          { src: iconData, sizes: "512x512", type: "image/svg+xml" }
        ]
      };

      const blob = new Blob([JSON.stringify(manifest)], { type: "application/manifest+json" });
      const url = URL.createObjectURL(blob);
      const link = document.getElementById("manifest-link");
      if (link) link.href = url;
    }

    function boot(){
      loadData();
      checkNewDayAndMisses();

      setDynamicManifest();
      initSplashVideo();

      updateSettingsUI();
      updateTodayUI();

      // always splash first
      showSplash();
      openTab('today');

      updateBedtimeCountdown();
      setInterval(updateBedtimeCountdown, 1000);
    }

    boot();
  </script>
</body>
</html>
